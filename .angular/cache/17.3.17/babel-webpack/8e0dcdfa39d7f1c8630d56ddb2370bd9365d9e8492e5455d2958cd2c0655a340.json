{"ast":null,"code":"import { inject } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormBuilder, ReactiveFormsModule, Validators } from '@angular/forms';\nimport { MatStepperModule } from '@angular/material/stepper';\nimport { MatButtonModule } from '@angular/material/button';\nimport { MatIconModule } from '@angular/material/icon';\nimport { MatCardModule } from '@angular/material/card';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport { IdentificacaoStepComponent } from './steps/identificacao.step';\nimport { PartesStepComponent } from './steps/partes.step';\nimport { ObrigacoesStepComponent } from './steps/obrigacoes.step';\nimport { ValoresStepComponent } from './steps/valores.step';\nimport { FiscalizacaoStepComponent } from './steps/fiscalizacao.step';\nimport { ContratosApi } from '../../shared/services/contratos.api';\nimport { existeElementoNoArray, dataValidaValidator, normalizarData } from '../../shared/validators/validators';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common\";\nimport * as i2 from \"@angular/material/stepper\";\nimport * as i3 from \"@angular/material/button\";\nimport * as i4 from \"@angular/material/card\";\nfunction ContratosPageComponent_ng_template_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Identifica\\u00E7\\u00E3o\");\n  }\n}\nfunction ContratosPageComponent_ng_container_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"app-identificacao-step\", 11);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const id_r1 = ctx.ngIf;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"group\", id_r1);\n  }\n}\nfunction ContratosPageComponent_ng_template_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Partes\");\n  }\n}\nfunction ContratosPageComponent_ng_container_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"app-partes-step\", 11);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const partes_r2 = ctx.ngIf;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"group\", partes_r2);\n  }\n}\nfunction ContratosPageComponent_ng_template_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Obriga\\u00E7\\u00F5es & Anexos\");\n  }\n}\nfunction ContratosPageComponent_ng_container_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"app-obrigacoes-step\", 12);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const obrigacoes_r3 = ctx.ngIf;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"array\", obrigacoes_r3);\n  }\n}\nfunction ContratosPageComponent_ng_template_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Valores & Reajuste\");\n  }\n}\nfunction ContratosPageComponent_ng_container_30_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"app-valores-step\", 11);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const valores_r4 = ctx.ngIf;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"group\", valores_r4);\n  }\n}\nfunction ContratosPageComponent_ng_template_37_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵtext(0, \"Fiscaliza\\u00E7\\u00E3o & SLA\");\n  }\n}\nfunction ContratosPageComponent_ng_container_38_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelement(1, \"app-fiscalizacao-step\", 11);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const fis_r5 = ctx.ngIf;\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"group\", fis_r5);\n  }\n}\nexport let ContratosPageComponent = /*#__PURE__*/(() => {\n  class ContratosPageComponent {\n    constructor() {\n      this.fb = inject(FormBuilder);\n      this.api = inject(ContratosApi);\n      this.snack = inject(MatSnackBar);\n      this.contratosCount = 0;\n      this.form = this.fb.group({\n        identificacao: this.fb.group({\n          numero: [null, Validators.required],\n          ano: [new Date().getFullYear(), [Validators.required]],\n          dataAssinatura: [null, [Validators.required, dataValidaValidator()]],\n          objeto: [null, [Validators.required, Validators.maxLength(500)]],\n          fornecedorId: [null, Validators.required],\n          endereco: this.fb.group({\n            cep: [null],\n            uf: [null],\n            cidade: [null],\n            logradouro: [null],\n            numero: [null],\n            complemento: [null],\n            bairro: [null]\n          })\n        }),\n        partes: this.fb.group({\n          fiscais: this.fb.control([]),\n          prepostoId: [null],\n          representantes: this.fb.control([])\n        }),\n        obrigacoes: this.fb.array([]),\n        valores: this.fb.group({\n          valorGlobal: [null, [Validators.required, Validators.min(0.01)]],\n          permiteReajuste: [true, Validators.required],\n          reajuste: this.fb.group({\n            indiceId: [null, Validators.required],\n            periodoMes: [12, [Validators.required, Validators.min(1), Validators.max(60)]],\n            dataInicioContagem: [null, [Validators.required, dataValidaValidator()]],\n            percentual: [null, [Validators.required, Validators.min(0), Validators.max(100)]]\n          })\n        }),\n        fiscalizacao: this.fb.group({\n          acordos: this.fb.control([]),\n          glosas: this.fb.array([], [existeElementoNoArray()])\n        }),\n        status: this.fb.control('rascunho', {\n          nonNullable: true\n        })\n      });\n    }\n    ngOnInit() {\n      const valores = this.form.get('valores');\n      if (valores && !valores.get('reajuste')) {\n        valores.addControl('reajuste', this.fb.group({\n          indiceId: [null, Validators.required],\n          periodoMes: [12, [Validators.required, Validators.min(1), Validators.max(60)]],\n          dataInicioContagem: [null, [Validators.required, dataValidaValidator()]],\n          percentual: [null, [Validators.required, Validators.min(0), Validators.max(100)]]\n        }));\n      }\n      const fiscalizacao = this.form.get('fiscalizacao');\n      if (fiscalizacao && !fiscalizacao.get('glosas')) {\n        fiscalizacao.addControl('glosas', this.fb.array([]));\n      }\n      if (fiscalizacao && !fiscalizacao.get('acordos')) {\n        fiscalizacao.addControl('acordos', this.fb.control([]));\n      }\n    }\n    ngAfterViewInit() {\n      this.api.listContratos().subscribe(list => this.contratosCount = list.length);\n    }\n    get obrigacoesArray() {\n      return this.form.get('obrigacoes');\n    }\n    salvarRascunho() {\n      const payload = this.form.getRawValue();\n      if (payload?.identificacao?.dataAssinatura) payload.identificacao.dataAssinatura = normalizarData(payload.identificacao.dataAssinatura);\n      if (payload?.valores?.reajuste?.dataInicioContagem) payload.valores.reajuste.dataInicioContagem = normalizarData(payload.valores.reajuste.dataInicioContagem);\n      this.api.createContrato(payload).subscribe(() => {\n        this.api.listContratos().subscribe(list => this.contratosCount = list.length);\n        this.snack.open('Rascunho salvo com sucesso.', 'OK', {\n          duration: 2500\n        });\n      });\n    }\n    enviarAprovacao() {\n      this.form.patchValue({\n        status: 'enviado'\n      });\n      const payload = this.form.getRawValue();\n      if (payload?.identificacao?.dataAssinatura) payload.identificacao.dataAssinatura = normalizarData(payload.identificacao.dataAssinatura);\n      if (payload?.valores?.reajuste?.dataInicioContagem) payload.valores.reajuste.dataInicioContagem = normalizarData(payload.valores.reajuste.dataInicioContagem);\n      this.api.createContrato(payload).subscribe(() => {\n        this.api.listContratos().subscribe(list => this.contratosCount = list.length);\n        this.snack.open('Contrato enviado para aprovação e salvo.', 'OK', {\n          duration: 2500\n        });\n      });\n    }\n    static {\n      this.ɵfac = function ContratosPageComponent_Factory(t) {\n        return new (t || ContratosPageComponent)();\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ContratosPageComponent,\n        selectors: [[\"app-contratos-page\"]],\n        standalone: true,\n        features: [i0.ɵɵStandaloneFeature],\n        decls: 46,\n        vars: 12,\n        consts: [[1, \"container\"], [\"linear\", \"\"], [3, \"stepControl\"], [\"matStepLabel\", \"\"], [4, \"ngIf\"], [1, \"actions\"], [\"mat-button\", \"\", \"matStepperNext\", \"\", \"color\", \"primary\", 3, \"disabled\"], [\"mat-button\", \"\", \"matStepperPrevious\", \"\"], [\"mat-button\", \"\", \"matStepperNext\", \"\", \"color\", \"primary\"], [\"mat-raised-button\", \"\", \"color\", \"accent\", 3, \"click\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 3, \"click\"], [3, \"group\"], [3, \"array\"]],\n        template: function ContratosPageComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"mat-card\", 0)(1, \"h2\");\n            i0.ɵɵtext(2, \"Cadastro de Contratos\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"p\");\n            i0.ɵɵtext(4);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"mat-horizontal-stepper\", 1)(6, \"mat-step\", 2);\n            i0.ɵɵtemplate(7, ContratosPageComponent_ng_template_7_Template, 1, 0, \"ng-template\", 3)(8, ContratosPageComponent_ng_container_8_Template, 2, 1, \"ng-container\", 4);\n            i0.ɵɵelementStart(9, \"div\", 5)(10, \"button\", 6);\n            i0.ɵɵtext(11, \"Pr\\u00F3ximo\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(12, \"mat-step\", 2);\n            i0.ɵɵtemplate(13, ContratosPageComponent_ng_template_13_Template, 1, 0, \"ng-template\", 3)(14, ContratosPageComponent_ng_container_14_Template, 2, 1, \"ng-container\", 4);\n            i0.ɵɵelementStart(15, \"div\", 5)(16, \"button\", 7);\n            i0.ɵɵtext(17, \"Voltar\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(18, \"button\", 8);\n            i0.ɵɵtext(19, \"Pr\\u00F3ximo\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(20, \"mat-step\");\n            i0.ɵɵtemplate(21, ContratosPageComponent_ng_template_21_Template, 1, 0, \"ng-template\", 3)(22, ContratosPageComponent_ng_container_22_Template, 2, 1, \"ng-container\", 4);\n            i0.ɵɵelementStart(23, \"div\", 5)(24, \"button\", 7);\n            i0.ɵɵtext(25, \"Voltar\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(26, \"button\", 8);\n            i0.ɵɵtext(27, \"Pr\\u00F3ximo\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(28, \"mat-step\", 2);\n            i0.ɵɵtemplate(29, ContratosPageComponent_ng_template_29_Template, 1, 0, \"ng-template\", 3)(30, ContratosPageComponent_ng_container_30_Template, 2, 1, \"ng-container\", 4);\n            i0.ɵɵelementStart(31, \"div\", 5)(32, \"button\", 7);\n            i0.ɵɵtext(33, \"Voltar\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(34, \"button\", 6);\n            i0.ɵɵtext(35, \"Pr\\u00F3ximo\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(36, \"mat-step\", 2);\n            i0.ɵɵtemplate(37, ContratosPageComponent_ng_template_37_Template, 1, 0, \"ng-template\", 3)(38, ContratosPageComponent_ng_container_38_Template, 2, 1, \"ng-container\", 4);\n            i0.ɵɵelementStart(39, \"div\", 5)(40, \"button\", 7);\n            i0.ɵɵtext(41, \"Voltar\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(42, \"button\", 9);\n            i0.ɵɵlistener(\"click\", function ContratosPageComponent_Template_button_click_42_listener() {\n              return ctx.salvarRascunho();\n            });\n            i0.ɵɵtext(43, \"Salvar Rascunho\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(44, \"button\", 10);\n            i0.ɵɵlistener(\"click\", function ContratosPageComponent_Template_button_click_44_listener() {\n              return ctx.enviarAprovacao();\n            });\n            i0.ɵɵtext(45, \"Enviar para Aprova\\u00E7\\u00E3o\");\n            i0.ɵɵelementEnd()()()()();\n          }\n          if (rf & 2) {\n            let tmp_3_0;\n            let tmp_9_0;\n            i0.ɵɵadvance(4);\n            i0.ɵɵtextInterpolate1(\"Total de contratos (mock): \", ctx.contratosCount, \"\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"stepControl\", ctx.form.get(\"identificacao\"));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.form.get(\"identificacao\"));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"disabled\", (tmp_3_0 = ctx.form.get(\"identificacao\")) == null ? null : tmp_3_0.invalid);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"stepControl\", ctx.form.get(\"partes\"));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.form.get(\"partes\"));\n            i0.ɵɵadvance(8);\n            i0.ɵɵproperty(\"ngIf\", ctx.form.get(\"obrigacoes\"));\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"stepControl\", ctx.form.get(\"valores\"));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.form.get(\"valores\"));\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"disabled\", (tmp_9_0 = ctx.form.get(\"valores\")) == null ? null : tmp_9_0.invalid);\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"stepControl\", ctx.form.get(\"fiscalizacao\"));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngIf\", ctx.form.get(\"fiscalizacao\"));\n          }\n        },\n        dependencies: [CommonModule, i1.NgIf, ReactiveFormsModule, MatStepperModule, i2.MatStep, i2.MatStepLabel, i2.MatStepper, i2.MatStepperNext, i2.MatStepperPrevious, MatButtonModule, i3.MatButton, MatIconModule, MatCardModule, i4.MatCard, IdentificacaoStepComponent, PartesStepComponent, ObrigacoesStepComponent, ValoresStepComponent, FiscalizacaoStepComponent]\n      });\n    }\n  }\n  return ContratosPageComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}